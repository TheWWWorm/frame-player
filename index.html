<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Random Video Player with Info Panel</title>
<style>
  body {
    margin: 0;
    background: black;
    display: flex;
    height: 100vh;
    color: white;
    font-family: sans-serif;
  }
  #video-container {
    flex: 0 0 auto;
    aspect-ratio: 16 / 9;
    background: black;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  video {
    height: 100%;
    width: auto;
  }
  #info {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    font-size: 2rem;
    background: rgba(0,0,0,0.6);
  }
  #time {
    font-size: 5rem;
    margin-bottom: 20px;
  }
  #weather {
    font-size: 2.5rem;
    text-align: center;
  }
  #controls {
  position: fixed;
  bottom: 20px;
  right: 20px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  z-index: 1000;
}

#controls button {
  background: rgba(0, 0, 0, 0.5);
  color: white;
  border: none;
  font-size: 1.5rem;
  padding: 10px;
  border-radius: 8px;
  cursor: pointer;
}

#controls button:hover {
  background: rgba(255, 255, 255, 0.2);
}

.hide-cursor {
  cursor: none;
}
</style>
</head>
<body>
<div id="video-container">
  <video id="player" autoplay muted playsinline></video>
</div>
<div id="controls">
  <button id="next-btn">‚è≠</button>
  <button id="mute-btn">üîá</button>
  <button id="fs-btn">‚õ∂</button>
</div>
<div id="info">
  <div id="time">--:--</div>
  <div id="weather">Loading weather...</div>
</div>

<script>
async function getVideos() {
  const res = await fetch("/list");
  return await res.json();
}

function shuffle(array) {
  return array.sort(() => Math.random() - 0.5);
}

// Clock
function updateTime() {
  const now = new Date();
  document.getElementById("time").textContent =
    now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', hour12: false });
}
setInterval(updateTime, 1000);
updateTime();

// Weather from Open-Meteo
async function updateWeather() {
  try {
    const lat = 56.9496;
    const lon = 24.1052;
    const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,weathercode&timezone=auto`;

    const res = await fetch(url);
    const data = await res.json();

    const temp = Math.round(data.current.temperature_2m);
    const code = data.current.weathercode;
    const [emoji, desc] = weatherDescription(code);

    document.getElementById("weather").textContent = `${emoji} ${temp}¬∞C, ${desc}`;
  } catch (err) {
    document.getElementById("weather").textContent = "Weather unavailable";
  }
}
updateWeather();
setInterval(updateWeather, 10 * 60 * 1000); // every 10 min

function weatherDescription(code) {
  const map = {
    0:  ["‚òÄÔ∏è", "Clear sky"],
    1:  ["üå§Ô∏è", "Mainly clear"],
    2:  ["‚õÖ", "Partly cloudy"],
    3:  ["‚òÅÔ∏è", "Overcast"],
    45: ["üå´Ô∏è", "Fog"],
    48: ["üå´Ô∏è", "Depositing rime fog"],
    51: ["üå¶Ô∏è", "Light drizzle"],
    53: ["üå¶Ô∏è", "Moderate drizzle"],
    55: ["üåßÔ∏è", "Dense drizzle"],
    56: ["üåßÔ∏è", "Freezing drizzle"],
    57: ["üåßÔ∏è", "Freezing drizzle"],
    61: ["üåßÔ∏è", "Slight rain"],
    63: ["üåßÔ∏è", "Moderate rain"],
    65: ["üåßÔ∏è", "Heavy rain"],
    66: ["üåßÔ∏è‚ùÑÔ∏è", "Freezing rain"],
    67: ["üåßÔ∏è‚ùÑÔ∏è", "Freezing rain"],
    71: ["‚ùÑÔ∏è", "Slight snow fall"],
    73: ["‚ùÑÔ∏è", "Moderate snow fall"],
    75: ["‚ùÑÔ∏è", "Heavy snow fall"],
    77: ["‚ùÑÔ∏è", "Snow grains"],
    80: ["üå¶Ô∏è", "Slight rain showers"],
    81: ["üå¶Ô∏è", "Moderate rain showers"],
    82: ["üåßÔ∏è", "Violent rain showers"],
    85: ["üå®Ô∏è", "Slight snow showers"],
    86: ["üå®Ô∏è", "Heavy snow showers"],
    95: ["‚õàÔ∏è", "Thunderstorm"],
    96: ["‚õàÔ∏è", "Thunderstorm with hail"],
    99: ["‚õàÔ∏è", "Thunderstorm with hail"]
  };
  return map[code] || ["‚ùì", "Unknown"];
}

// Video playlist
(async () => {
  const videos = await getVideos();
  if (!videos.length) {
    alert("No videos found");
    return;
  }

  let queue = shuffle([...videos]);
  const player = document.getElementById("player");
  const nextBtn = document.getElementById("next-btn");
  const muteBtn = document.getElementById("mute-btn");
  const fsBtn = document.getElementById("fs-btn");

  function playNext() {
    if (queue.length === 0) {
      queue = shuffle([...videos]);
    }
    const next = queue.pop();
    player.src = `/videos/${encodeURIComponent(next)}`;
    player.play();
  }

  player.addEventListener("ended", playNext);

  // Start muted so autoplay works
  player.muted = true;
  playNext();

  nextBtn.addEventListener("click", playNext);

  // Mute/unmute toggle
  muteBtn.addEventListener("click", () => {
    player.muted = !player.muted;
    muteBtn.textContent = player.muted ? "üîá" : "üîä";
  });

  // Fullscreen toggle
  fsBtn.addEventListener("click", () => {
    if (!document.fullscreenElement) {
      document.documentElement.requestFullscreen();
    } else {
      document.exitFullscreen();
    }
  });
})();


let hideCursorTimer;

function resetCursorTimer() {
  document.body.classList.remove("hide-cursor");
  clearTimeout(hideCursorTimer);
  hideCursorTimer = setTimeout(() => {
    document.body.classList.add("hide-cursor");
  }, 3000); // 3 seconds
}

// Reset timer on mouse movement
document.addEventListener("mousemove", resetCursorTimer);

// Start the timer on page load
resetCursorTimer();

</script>
</body>
</html>
